<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="generator" content="Publish.jl" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="" />
    <title>DLPipelines.jl</title>
    <link rel="stylesheet" href="..&#x2F;..&#x2F;normalize.css" />
    <link rel="stylesheet" href="..&#x2F;..&#x2F;tabulator_simple.min.css" />
    <link rel="stylesheet" href="..&#x2F;..&#x2F;lorenzo.css" />
    <script src="..&#x2F;..&#x2F;versions.js"></script>
    <script src="..&#x2F;..&#x2F;lunr.js"></script>
    <script src="..&#x2F;..&#x2F;highlight.min.js"></script>
    <script src="..&#x2F;..&#x2F;tabulator.min.js"></script>
    <script src="..&#x2F;..&#x2F;julia.min.js"></script>
    <script src="..&#x2F;..&#x2F;julia-repl.min.js"></script>
    <script src="..&#x2F;..&#x2F;publish.js"></script>
    
<link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lora:wght@700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lora:wght@500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lora:ital@1&family=Source+Sans+Pro:wght@700&display=swap" rel="stylesheet">
    <!-- 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
        -->

</head>
<body>
    <div class="menu">
        <svg id="menu-toggler" title="Contents" onclick="toggleIndexPage();" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor" /><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor" /><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor" /></svg>
        <input id="search-input" placeholder="Search">
        <select id="version-selector"></select>
    </div>
    <main id="page"><article><h1 id="using-with-fluxtrainingjl"><a href="#using-with-fluxtrainingjl" class="anchor"></a>Using with FluxTraining.jl</h1>
<p><em>DLPipelines.jl</em> works great together with
<a href="https://github.com/lorenzoh/FluxTraining.jl"><em>FluxTraining.jl</em></a>.</p>
<p>We’ll train an image classifier to show how.</p>
<p>If you want to follow along, you’ll have to install some other libraries</p>
<pre><code class="language-julia">using Pkg
Pkg.add(&quot;DataLoaders&quot;)
Pkg.add(&quot;Flux&quot;)
Pkg.add(&quot;LearnBase&quot;)
Pkg.add(&quot;MLDataPattern&quot;)
Pkg.add(url=&quot;https://github.com/lorenzoh/DLDatasets.jl&quot;)
Pkg.add(url=&quot;https://github.com/lorenzoh/FluxTraining.jl&quot;)
Pkg.add(url=&quot;https://github.com/lorenzoh/ModelUtils.jl&quot;)
Pkg.add(url=&quot;https://github.com/lorenzoh/FluxModels.jl&quot;)
</code></pre>
<p>and import the following:</p>
<pre><code cell="main" class="language-julia">using DataLoaders: DataLoader
using DLPipelines
using DLDatasets: ImageNette, loaddataset, metadata
using Flux: ADAM, logitcrossentropy
using FluxModels: xresnet18
using FluxTraining: Learner, fit!
using LearnBase: getobs
using MLDataPattern: splitobs
</code></pre>
<p>Recall the 4 things needed to start training with <em>FluxTraining.jl</em>:</p>
<ul>
<li>a model to train,</li>
<li>a loss function,</li>
<li>an optimizer; and</li>
<li>training and validation data iterators</li>
</ul>
<p>For the first three we use:</p>
<pre><code cell="main" result="false" class="language-julia">lossfn = logitcrossentropy
optimizer = ADAM()
model = xresnet18()
</code></pre>
<p>The last part is where <em>DLPipelines.jl</em> comes in.</p>
<p>As in the <a href="../methods/imageclassification.html"><code>ImageClassification</code> overview</a>,
we first need to load an image classification dataset:</p>
<pre><code cell="main" result="false" class="language-julia">dataset = loaddataset(ImageNette, &quot;v2_160px&quot;)
categories = metadata(ImageNette).labels
</code></pre>
<p>Now we construct an <a href="../../docstrings/DLPipelines.ImageClassification.html"><code>ImageClassification</code></a> object with
the proper configuration:</p>
<pre><code cell="main" class="language-julia">method = ImageClassification(categories, sz = (128, 128))
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">ImageClassification() with 10 categories.</code></pre>
<p>After splitting the dataset into training and validation split, we can use
<a href="../../docstrings/DLPipelines.MethodDataset.html"><code>MethodDataset</code></a> to get data containers that will encode the
observations.</p>
<pre><code cell="main" class="language-julia">traindataset_, validdataset_ = splitobs(dataset, 0.8)
traindataset = MethodDataset(traindataset_, method, Training())
validdataset = MethodDataset(validdataset_, method, Validation())
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">MethodDataset{ImageClassification}
  data: MLDataPattern.DataSubset{DLDatasets.FileDataset,UnitRange{Int64},LearnBase.ObsDim.Undefined}
  method: ImageClassification
  context: Validation Validation()
</code></pre>
<p>By passing either <a href="../../docstrings/DLPipelines.Training.html"><code>Training</code></a> or <a href="../../docstrings/DLPipelines.Validation.html"><code>Validation</code></a> as <a href="../../docstrings/DLPipelines.Context.html"><code>Context</code></a>
to the datasets, the correct transformations will be automatically applied.
For example, a random crop will be used for the <code>traindataset</code>, while
images in <code>validdataset</code> will always be cropped from the center.</p>
<p>Loading an observation from either will now correctly return a normalized
3D-array with the image data and a one-hot encoded category:</p>
<pre><code cell="main" class="language-julia">x, y = getobs(traindataset, 1)
summary.((x, y))
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">(&quot;128×128×3 Array{Float32,3}&quot;, &quot;10-element Array{Float32,1}&quot;)</code></pre>
<p>To finally get an iterator over batches, we can use <code>DataLoader</code> from
<a href="https://lorenzoh.github.io/DataLoaders.jl/dev/README.html">DataLoaders.jl</a>.
It will also make sure to prefetch the data on background threads so that
the training loop isn’t slowed down waiting for the next batch of data.</p>
<pre><code cell="main" result="false" class="language-julia">batchsize = 16
traindl = DataLoader(traindataset, batchsize)
validdl = DataLoader(validdataset, batchsize)
</code></pre>
<p>Now we can create a <code>Learner</code>:</p>
<pre><code cell="main" class="language-julia">learner = Learner(model, (traindl, validdl), optimizer, lossfn)
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">Learner()</code></pre>
<p>You can pass any number of
<a href="https://lorenzoh.github.io/FluxTraining.jl/dev/docs/callbacks/reference.html">callbacks</a>
to <code>Learner</code>, for example <code>ToGPU()</code> to utilize your GPU when training.</p>
<p>And that’s it, you can start training with a call to <code>fit!</code>:</p>
<pre><code class="language-julia">fit!(learner, 10)
</code></pre>
<p>To find out more about what you can do with <em>FluxTraining.jl</em>, see
<a href="https://lorenzoh.github.io/FluxTraining.jl/dev/README.html">its documentation</a>.</p>
</article>
        <div id="page-navigation">
            <a id="previous-page" title="Previous" href="..&#x2F;transforms.html"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.2426 6.34317L14.8284 4.92896L7.75739 12L14.8285 19.0711L16.2427 17.6569L10.5858 12L16.2426 6.34317Z" fill="currentColor" /></svg></a>
            <a id="next-page" title="Next" href="..&#x2F;..&#x2F;src&#x2F;DLPipelines.html"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5858 6.34317L12 4.92896L19.0711 12L12 19.0711L10.5858 17.6569L16.2427 12L10.5858 6.34317Z" fill="currentColor" /></svg></a>
        </div>
    </main>
    <nav id="toc"><h2 id="dlpipelinesjl"><a href="../../#dlpipelinesjl" class="anchor"></a>DLPipelines.jl</h2>
<ul>
<li><a href="../../README.html">Readme</a></li>
<li><a href="../../docs/introduction.html">Introduction</a></li>
<li><a href="../../docs/interfaces/overview.html">Interfaces</a>
<ul>
<li><a href="../../docs/interfaces/core.html">Core interface</a></li>
</ul>
</li>
<li><a href="../../docs/methods/methods.html">Methods</a>
<ul>
<li><a href="../../docs/methods/imageclassification.html">Image classification</a></li>
</ul>
</li>
<li><a href="../../docs/transforms.html">Transforms</a></li>
<li>Tutorials
<ul>
<li><a href="../../docs/tutorials/fluxtraining.html">Using with FluxTraining.jl</a></li>
</ul>
</li>
</ul>
<h3 id="source-code"><a href="../../#source-code" class="anchor"></a>Source code</h3>
<ul>
<li><a href="../../src/DLPipelines.html"><code>DLPipelines.jl</code></a></li>
<li><a href="../../src/task.html"><code>task.jl</code></a></li>
<li><a href="../../src/dataset.html"><code>dataset.jl</code></a></li>
<li><code>transforms</code>
<ul>
<li><a href="../../src/transforms/spatial.html"><code>spatial.jl</code></a></li>
<li><a href="../../src/transforms/imagepreprocessing.html"><code>imagepreprocessing.jl</code></a></li>
</ul>
</li>
<li><code>methods</code>
<ul>
<li><a href="../../src/methods/imageclassification.html"><code>imageclassification.jl</code></a></li>
</ul>
</li>
</ul>
<h3 id="tests"><a href="../../#tests" class="anchor"></a>Tests</h3>
<ul>
<li><a href="../../test/runtests.html"><code>runtests.jl</code></a></li>
</ul>
</nav>
    <footer>
        Built with <a target="_blank" href="https://github.com/MichaelHatherly/Publish.jl">Publish.jl</a> and the <a target="_blank" href="https://julialang.org">Julia Language.</a>
    </footer>
    <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
